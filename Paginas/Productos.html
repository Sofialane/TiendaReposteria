<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>
    <link rel="stylesheet" href="../style.css">

    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>

    <header class="contenedor">
        <nav class= "nav-menu">
            <img class="img-nav" src="../imgs/transparentlogocnc.png" alt="Logo CNC">
            <ul class="nav-items">
                <li><a href="../index.html">Inicio</a></li>
                <li> <a href="">Productos</a></li>
                <li><a href="Fechas.html">Fechas Especiales</a>
                    <ul>
                        <li><a href="#">San Valentin</a> </li> 
                        <li><a href="#">Pascuas</a> </li>
                        <li><a href="#">Dia de la madre</a>
                        <li><a href="#">Dia del padre</a> </li> 
                        <li><a href="#">Dia de los abuelos</a> </li> 
                        <li><a href="#">Dia del niño</a> </li> 
                        <li><a href="#">Dia del maestro</a> </li>
                        <li><a href="#">Navidad</a> </li>   
                    </ul> 
                </li>   
                <li><a href="Pedidos.html">Pedidos</a></li>
                <li><a href="Informacion.html">Informacion</a>
                </li>
            </ul>
            
            <!--MENU DESPLEGABLE RESPONSIVE-->
            <input type="checkbox" id="boton-menu">
            <label for="boton-menu"><i data-feather="menu"></i></label>

        </nav> 
    </header>    
    <section class="texto-productos">
        <h3>Lorem ipsum dolor sit amet consectetur adipisicing elit.</h3>
        <br>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Libero recusandae exercitationem 
            officiis tempore error et laudantium porro aliquam impedit perspiciatis eveniet placeat, 
            ipsa nisi dolor quis, fuga ducimus debitis quam cumque quasi accusantium. Architecto autem 
            officiis itaque non vel molestiae natus animi earum, ipsum, placeat aperiam illum at amet 
            aliquid ab exercitationem alias perspiciatis nam, consectetur dolorum. Animi exercitationem, 
            delectus deserunt eveniet, aut repellendus soluta, tempore facere tempora alias dolorum velit 
            quidem! Esse vitae illum voluptatem dolor, suscipit quis, atque exercitationem accusantium 
            reprehenderit cum minima odio doloremque rerum, iusto quaerat magnam fuga doloribus! Ipsam quasi
            deserunt architecto voluptas quisquam? Repudiandae.</p> 
                  
    </section>
    <section class="buscador">
        <label for="searchBar" >Buscar</label>
        <input id="searchBar">
    
        <section id="SearchPlace"></section>
    </section>
    <div id="listado-productos">
        <section id="contenido">
            <div id="Productos">
                <h3>Productos</h3>
                <div id="product-holder"></div>
            </div>
            <div id="Carrito">
                <h3>Carrito</h3>
                <ul id="cart-holder">
                    <li>
                        <p>Shampoo</p>
                        <input id="quantity"/>
                        <p>1000</p>
                    </li>
                    <li>
                        <p>Shampoo</p>
                        <input id="quantity"/>
                        <p>1000</p>
                    </li>
                </ul>
                <p>Total $<span id="total-holder">2000</span></p>
            </div>
        </section>
    </div>

    <section id="product">

    </section>
    <footer>
        <section class="logo-footer">
            <img src="../imgs/transparentlogocnc.png" alt="Logo CNC">
        </section>
        <section id="ubicacion">
            <h3>Ubicacion</h3>
            <p>Nos encontramos ubicados para retiro de pedidos en Ciudad de la Costa.</p>
        </section>
        <section id="redes">
            <h3>Seguinos en nuestras redes!</h3>
                <ul>
                    <li>
                        <a href="#"> 
                            <i data-feather="instagram"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i data-feather="facebook"></i>
                        </a>
                    </li>
                </ul>
        </section>
    
    </footer>

    <script src="../products.js"></script>
    <script>
        feather.replace()
    </script>

    <script>

        const productHolder = document.getElementById('product-holder');
        const cartHolder = document.getElementById('cart-holder');
        const totalHolder = document.getElementById('total-holder')

        let total = 0;

        let categories = ['Tortas', 'Postres', 'Alfajores', 'Masitas', 'Galletas', 'Cupcakes', 'Otros']
    
        productHolder.innerHTML = ''
        cartHolder.innerHTML = ''
        totalHolder.innerHTML = total

        let products = [
            new Product(1, 'Torta temática simple', 'Torta de un piso para 20 personas, con merengue y decoracion en fondant', 1400, 10, null, 'Tortas'),
            new Product(2, 'Cheesecake', 'Postre cheesecake de frutillas para 18 personas', 950, 4, null, 'Postres'),
            new Product(3, 'Alfajores de salchichon', 'Salchichon de chocolate relleno de dulce de leche bañado de chocolate amargo o blanco. Se venden de a 6 unidades', 240, 150, null, 'Alfajores'),
            new Product(4, 'Alfajores de maicena', 'Los mejores alfajores de maicena que podrás probar. Se venden de a 6 unidades', 280, 100, null, 'Alfajores'),
            new Product(5, 'Alfajores de chocolate', 'La bomba de chocolate que necesitabas, se venden de a 6 unidades', 280, 100, null, 'Alfajores'),
            new Product(6, '1/2 kilo de masitas', 'Masitas surtidas', 300, 15, null, 'Masitas'),
            new Product(7, '1 kilo de masitas', 'Masitas surtidas', 580, 15, null, 'Masitas'),
            new Product(8, 'Donas', 'Las mejores donas que vas a probar. Se venden de a 6 unidades', 300, 50, null, "Otros"),
            new Product(9, 'Galletas con fondant', 'Galletas tematicas decoradas con fondant. Se venden por docena', 580, 10, null, 'Galletas'),
            new Product(10, 'Cupcakes con merengue', 'Cupcakes decorados con merengue y decoracion simple en fondant. Se vende de a 6 unidades.', 250, 10, null, 'Cupcakes'),
            new Product(11, 'Paletas de oreo', 'De chocolate blanco o negro, relleno de oreo c/dulce de leche. Minimo 4 unidades. Precio por tematicas varia segun diseño.', 300, 50, null, 'Otros'),
        ]
            
        let innerHTMLForProductHolder = ''
           

        products.forEach(product => {
            innerHTMLForProductHolder += product.asInnerHTMLForMainList()
        })

        productHolder.innerHTML = innerHTMLForProductHolder
            

        function searchProduct() {
            let input = document.getElementById('searchBar').cartLine
            let filteredProduct = products.filter(product => product.name.includes(input))
            if(input.length !== 0) {
                filteredProducts = products.filter(product =>
                    product.name.toLowerCase().includes(input.toLowerCase()) ||
                    product.description.toLowerCase().includes(input.toLowerCase()) ||
                    product.id == input
                )
            }else {
                filteredProducts = products
            }

            /*CON EL HOLDER INNERHTML BORRA LO QUE HAYA ESCRITO. BORRA Y REESCRIBE*/
            productHolder.innerHTML = ''
                

            filteredProducts = filteredProducts.sort((a,b) => a.name.localeCompare(b.name))
                
            innerHTMLForProductHolder = ''

            filteredProducts.forEach(product => {
                innerHTMLForProductHolder += product.asInnerHTMLForMainList()
            })
            productHolder.innerHTML = innerHTMLForProductHolder;
        } 

        document.getElementById('searchBar').addEventListener('keyup',searchProduct)

        let cart = []

        function addToCart(props){
            let product = products.find(cartLine => cartLine.id == props)
            cart.push({
                product: product,
                quantity: 1
            })
            renderCart()
        }

        function renderCart(){
            cartHolder.innerHTML = '' 
            totalHolder.innerHTML = 0
            total = 0;
            cart.forEach(cartLine => {
                total += cartLine.product.price * cartLine.quantity;
                cartHolder.innerHTML += `<li>
                        <p>${cartLine.product.name}</p>
                        <input id="quantity${cartLine.product.id}" cartLine=${cartLine.quantity}>
                        <p id="priceById${cartLine.product.id}">${cartLine.product.price * cartLine.quantity}</p>
                    </li>`
                document.getElementById(`quantity${cartLine.product.id}`).addEventListener('keyup',(event) => editQuantity(e, cartLine.product.id));
            })
            totalHolder.innerHTML = total
        }

        function editQuantity(event,productId){
            let quantity = event.target.value;
            let cartLine = cart.find(cartLine => value.product.id == productId)

            cartLine.quantity = quantity
            document.getElementById(`priceById${productId}`).innerHTML = cartLine.product.price * quantity
            total = 0

            cart.forEach(cartLine => {
                total += cartLineproduct.price * cartLine.quantity;
            })
            
            totalHolder.innerHTML = total
        }
   
    </script>
</body>
</html>